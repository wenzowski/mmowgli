<?xml version="1.0" encoding="UTF-8"?>
<!-- 
  Copyright (C) 2010-2014 Modeling Virtual Environments and Simulation
  (MOVES) Institute at the Naval Postgraduate School (NPS)
  http://www.MovesInstitute.org and http://www.nps.edu
 
  This file is part of Mmowgli.
  
  Mmowgli is free software: you can redistribute it and/or modify
  it under the terms of the GNU General Public License as published by
  the Free Software Foundation, either version 3 of the License, or
  any later version.

  Mmowgli is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  GNU General Public License for more details.

  You should have received a copy of the GNU General Public License
  along with Mmowgli in the form of a file named COPYING.  If not,
  see <http://www.gnu.org/licenses/>
-->

<web-app id="WebApp_ID" version="3.0" xmlns="http://java.sun.com/xml/ns/javaee" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd">

	<display-name>COIN mmowgli</display-name>

	<context-param><param-name>productionMode</param-name> <param-value>true</param-value>                   <!-- Vaadin production mode--></context-param>
	<context-param><param-name>deployment</param-name>     <param-value>COIN</param-value>                   <!-- Normally the value is game, test or cluster, but can be localhost for dev--></context-param>
	<context-param><param-name>dbName</param-name>         <param-value>COIN</param-value>                   <!-- The db within the mysql server--></context-param>
	<context-param><param-name>dbUrl</param-name>          <param-value>jdbc:mysql://web4:3306/</param-value><!-- IP location of mmowgli mysql server--></context-param>
	<context-param><param-name>dbUser</param-name>         <param-value>mmowgli</param-value>                <!-- User account for access by the app code to the mysql server--></context-param>
	<context-param><param-name>dbPassword</param-name>     <param-value>gwtservelet</param-value>            <!-- Password for application user account on mysql server--></context-param>
	<context-param><param-name>dbDropAndCreate</param-name><param-value>false</param-value>                  <!-- This is dangerous to do!! Only flip to true to create the db tables at the beginning of life!--></context-param>
  
    <context-param><param-name>piiDbName</param-name>      <param-value>COIN</param-value>                   <!-- The db within the mysql server for the pii classes (here we're using the same db)--></context-param>
  
	<context-param><param-name>c3p0MaxSize</param-name>          <param-value>200</param-value> <!-- production 200, archive 20--></context-param>
	<context-param><param-name>c3p0MinSize</param-name>          <param-value>5</param-value>   <!-- production 5, archive 5--></context-param>
	<context-param><param-name>c3p0AcquireIncrement</param-name> <param-value>10</param-value>  <!-- production 10, archive 5--></context-param>
	<context-param><param-name>c3p0Timeout</param-name>          <param-value>3600</param-value><!-- in seconds--></context-param>
	<context-param><param-name>c3p0IdleTestPeriod</param-name>   <param-value>1800</param-value><!-- in seconds--></context-param>

	<context-param><param-name>hibernateSearchIndexPath</param-name><param-value>/tmp/mmowgliLucene/COIN</param-value><!-- Where on the local machine the hibernate-lucene indices are put--></context-param>

	<context-param><param-name>clusterMaster</param-name> <param-value>web7</param-value>        <!-- Which cluster is the "master", which does special things, like run the badge manager--></context-param>
	<context-param> <param-name>smtpHost</param-name>     <param-value>mule.nps.edu</param-value><!-- Where mmowgli sends emails to be delivered--></context-param>

  <!-- Inter-cluster and intra-cluster messaging -->
  <!-- ***************************************** -->
  <!-- Defines the Java Message System (JMS) URL connection. By default this runs
    on web3 (web4 for production) in the private cluster, on tcp port 61616, the default for activemq. -->
      
  <!-- Defines the Java Message System (JMS) topic. This is the "subject" 
    that this application publishes to and subscribes to on the broker for exchanging 
    messages between tomcat servers. -->
      
  <context-param><param-name>jmsUrl</param-name>                <param-value>tcp://web3:61616?wireFormat.maxInactivityDuration=0</param-value><!--JMS URL--></context-param>
  <context-param><param-name>jmsTopic</param-name>              <param-value>COIN</param-value>                                               <!--JMS Topic--></context-param>
  <context-param><param-name>jmsKeepAliveIntervalMS</param-name><param-value>300000</param-value>                                             <!--Time between keep-alive polls in millisecs--></context-param>

  <context-param><param-name>deploymentToken</param-name>     <param-value>{{DEPLOY}}</param-value>                                   <!--Token specifying insertion of deployment string--> </context-param>
  <context-param><param-name>gameUrlToken</param-name>        <param-value>{{GAMEURL}}</param-value>                                  <!--Token specifying insertion of base game url--></context-param>
  <context-param><param-name>gameImagesUrl</param-name>       <param-value>https://web.mmowgli.nps.edu/mmowMedia/images/</param-value><!--Where the game images reside, normally same place game css files point to--></context-param>
  <context-param><param-name>userImagesPath</param-name>      <param-value>/mmowgli/shared/images/{{DEPLOY}}/</param-value>           <!--File system path on server where uploaded images sit--></context-param>
  <context-param><param-name>userImagesUrl</param-name>       <param-value>{{GAMEURL}}images/</param-value>                           <!--Url pointing to the uploaded images repository--></context-param>
  <context-param><param-name>gameReportsPath</param-name>     <param-value>/mmowgli/shared/images/reports/{{DEPLOY}}/</param-value>   <!--File system path on server where uploaded reports sit--></context-param>
  <context-param><param-name>gameReportsUrl</param-name>      <param-value>{{GAMEURL}}reports/</param-value>                          <!--Url pointing to the uploaded reports repository--></context-param>
  <context-param><param-name>reports2ImagesPrefix</param-name><param-value>../images/</param-value>                                   <!--The prefix added to image names to form the relative url in an action plan--></context-param>

  <!-- Media virus scanner, further arguments can be 'clamScanArgument1', 'clamScanArgument2', etc. -->
  <!-- Cmd to OS will be 'clamScanPath [clamScanArgument] [clamScanArgument1 [clamScanArgument2...]] filename' -->

  <context-param><param-name>clamScanPath</param-name>    <param-value>clamdscan</param-value>   <!--  path to clamscan virus checker (optional)--></context-param>
  <context-param><param-name>clamScanArgument</param-name><param-value>--no-summary</param-value><!--  The prefix added to image names to form the relative url in an action plan--></context-param>
  <context-param><param-name>transport</param-name>       <param-value>long-polling</param-value><!--  not readable by my code as servlet init-param, not handled by vaadin as an annotation would be, put it here, but reading this by code, then putting it into the pushconfiguration dynamically doesn't seem to do anything. --></context-param>

  <session-config>
    <!-- 15 minute user inactivity timeout by default; must be longer than default vaadin heartbeat of 5 minutes -->
    <session-timeout>15</session-timeout>
    <tracking-mode>COOKIE</tracking-mode>
  </session-config>

  <servlet>
    <servlet-name>Mmowgli2</servlet-name>
    <servlet-class>edu.nps.moves.mmowgli.Mmowgli2VaadinServlet</servlet-class>
    <init-param><param-name>disable-xsrf-protection</param-name> <param-value>true</param-value></init-param>
    <init-param><param-name>transport</param-name>               <param-value>long-polling</param-value>      <!--  not readable by my code and not handled by vaadin as an annotation would be, so put into context-param --></init-param>
  </servlet>

   <listener>
    <!-- required for Vaadin 7 push -->
    <listener-class>org.atmosphere.cpr.SessionSupport</listener-class>
  </listener>

    <!--Â  makes use of javamelody, a utility that allows tomcat container monitoring. -->
    <!-- *************************************************************************** -->
	<filter>
		<filter-name>monitoring</filter-name>
		<filter-class>net.bull.javamelody.MonitoringFilter</filter-class>
        <async-supported>true</async-supported>
     </filter>
	<filter-mapping>
		<filter-name>monitoring</filter-name>
		<url-pattern>/*</url-pattern>
	</filter-mapping>
	<listener>
		<listener-class>net.bull.javamelody.SessionListener</listener-class>
	</listener>
	<login-config>
		<auth-method>BASIC</auth-method>
		<realm-name>Monitoring</realm-name>
	</login-config>
	<security-role>
		<role-name>monitoring</role-name>
	</security-role>
	<security-constraint>
		<web-resource-collection>
			<web-resource-name>Monitoring</web-resource-name>
			<url-pattern>/monitoring</url-pattern>
		</web-resource-collection>
		<auth-constraint>
			<role-name>monitoring</role-name>
		</auth-constraint>
		<!-- if SSL enabled (SSL and certificate must then be configured in the server) <user-data-constraint> <transport-guarantee>CONFIDENTIAL</transport-guarantee></user-data-constraint> -->
	</security-constraint>

	<welcome-file-list>
		<welcome-file>index.html</welcome-file>
		<welcome-file>index.htm</welcome-file>
		<welcome-file>index.jsp</welcome-file>
		<welcome-file>default.html</welcome-file>
		<welcome-file>default.htm</welcome-file>
		<welcome-file>default.jsp</welcome-file>
	</welcome-file-list>
</web-app>